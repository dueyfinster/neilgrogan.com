<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no"><title>Using IPv6 with Docker Compose on Ubuntu Server | Neil Grogan</title><link rel=apple-touch-icon sizes=180x180 href=../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../favicon-16x16.png><link rel=icon type=image/png sizes=96x96 href=../favicon-96x96.png><link rel=manifest href=../manifest.json><link rel=mask-icon href=../safari-pinned-tab.svg color=#ff3db4><meta name=theme-color content="#ffffff"><link rel=stylesheet href=../css/main.min.15431d6c334f65809fe2bc329da3f2c81c6e3027ab1e25b56afb2bb85fa7fd64.css><script src=https://unpkg.com/lunr/lunr.js></script></head><body><nav><header><div class=site-title><a href=../>Neil Grogan</a></div></header><div class=nav-menu><a class="color-link nav-link" href=../about>About</a>
<a class="color-link nav-link" href=../projects>Projects</a>
<a class="color-link nav-link" href=../presentations/>Presentations</a>
<a class="color-link nav-link" href=../contact>Contact</a>
<a class="color-link nav-link" href=../archives/>Archives</a>
<a class="color-link nav-link" href=../tags/>Tags</a>
<a class="color-link nav-link" href=../index.xml target=_blank rel=noopener type=application/rss+xml>RSS</a></div><footer class=footer><div class=social-icons></div><script src=../js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww=" crossorigin=anonymous></script><script src=../js/lunr-search.js></script></footer></nav><div id=content class=content-container><h1 class=post-title>Using IPv6 with Docker Compose on Ubuntu Server</h1><time>February 8, 2019</time><div><p><p>I recently started using <a href=https://pi-hole.net/>PiHole</a> to block ads on my home network. As the name
suggests, you install it on a <a href=https://raspberrypi.org/>raspberry pi</a>. I left it in situ for about a
month, until I decided I wanted to swap out the pi, but keep PiHole.</p><p>The natural solution to this, is to use a docker container. Rather helpfully,
there is a publicly available <a href=https://github.com/pi-hole/docker-pi-hole>docker build of PiHole</a>. Simple,
right? Well my home network is also IPv6, thus the <a href=https://en.wikipedia.org/wiki/Domain_Name_System>DNS</a> on the raspberrypi
should be also. The problem is, <a href=https://docs.docker.com/v17.09/engine/userguide/networking/default_network/ipv6/>Docker has support for IPv6</a>, but it&rsquo;s
not very straightforward with <a href=https://docs.docker.com/compose/>Docker Compose</a>.</p><p>After a lot of fiddling about, I finally managed it. As per the Docker IPv6
documentation, on Linux (I used Ubuntu Server) you need to add a configuration
file to enable IPv6, at <code>/etc/docker/daemon.json</code>:</p><pre><code>{
  &quot;ipv6&quot;: true,
  &quot;fixed-cidr-v6&quot;: &quot;2001:db8:1::/64&quot;
}
</code></pre><p>Then you need to restart Docker daemon:</p><p><code>$ sudo systemctl restart docker</code></p><p>that will allow the new <code>daemon.json</code> file to take effect.</p><p>After this, I had an existing setup with <a href=https://www.plex.tv/>Plex</a> and <a href=../self-host>other things</a> already
controlled by <code>docker-compose</code>. The solution here is to kill all your
containers and recreate the compose network by hand with IPv6 subnet:</p><pre><code>$ cd &lt;my_compose_dir&gt;
$ docker network ls # name of compose network should have directory name in it
$ docker network inspect &lt;compose_net_name&gt; # Make note of exisiting IPv4
Subnet/Gateway
$ docker-compose kill # Kill all your existing containers
$ docker network prune # Remove/Prune the network (as no more containers are attached)
$ docker network create --subnet=172.18.0.0/16 --gateway=172.18.0.1 --ipv6 --subnet=2001:db8:2::/64 &lt;compose_net_name&gt;
</code></pre><p>and lastly for the piece de resistance, let&rsquo;s bring up our compose containers:</p><p><code>$ docker-compose up -d</code></p><p>now we can also verify we get IPv6 working internally (see this <a href=http://collabnix.com/enabling-ipv6-functionality-for-docker-and-docker-compose/>helpful post
here</a>):</p><pre><code>$ docker run -itd ajeetraina/ubuntu-iproute bash # Start first container
$ docker run -itd ajeetraina/centos-iproute bash # Start second container (new
terminal)
</code></pre><p>In both containers you can run:</p><p><code>$ ifconfig eth0</code></p><p>which will show you the IPv6 address of each. Then from either container, you
can ping the other with:</p><p><code>$ ping6 &lt;ipv6_address></code></p><p>and it all should work nicely!</p></p></div><div class=page-footer><hr class=footer-divider><a class=tag href=../tags/docker>#docker</a></div></div><footer class=footer-mobile><div class=social-icons></div><script src=../js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww=" crossorigin=anonymous></script></footer></body></html>