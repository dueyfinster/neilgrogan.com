<!doctype html><html lang=en><head><meta charset=utf-8><title>Using IPv6 with Docker Compose on Ubuntu Server</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.69.0"><link href rel=alternate type=application/rss+xml title="Neil Grogan"><link href=../css/bootstrap.min.css rel=stylesheet><link href=../css/hc.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css rel=stylesheet></head><body><div class=nav-toggle><i class="fa fa-bars fa-2x"></i>Herring Cove</div><div id=wrapper><div class="navbar navbar-default" role=navigation><div class=container><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a href=../><p class=navbar-brand>Neil Grogan</p></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav"></ul></div></div></div><div id=sidebar-wrapper><ul class=sidebar-nav><img src><li class=sidebar-brand><a href=../><h1 class=brand>Neil Grogan</h1></a><h3>My home on the internet</h3></li><hr><hr><div id=social-wrapper></div></ul></div><div class=container><div id=article><div class=article-title>Using IPv6 with Docker Compose on Ubuntu Server</div><p class=meta><small>&nbsp;<i class="fa fa-calendar-o"></i> 2019-02-08</small></p><hr><div class=post><p>I recently started using <a href=https://pi-hole.net/>PiHole</a> to block ads on my home network. As the name
suggests, you install it on a <a href=https://raspberrypi.org/>raspberry pi</a>. I left it in situ for about a
month, until I decided I wanted to swap out the pi, but keep PiHole.</p><p>The natural solution to this, is to use a docker container. Rather helpfully,
there is a publicly available <a href=https://github.com/pi-hole/docker-pi-hole>docker build of PiHole</a>. Simple,
right? Well my home network is also IPv6, thus the <a href=https://en.wikipedia.org/wiki/Domain_Name_System>DNS</a> on the raspberrypi
should be also. The problem is, <a href=https://docs.docker.com/v17.09/engine/userguide/networking/default_network/ipv6/>Docker has support for IPv6</a>, but it&rsquo;s
not very straightforward with <a href=https://docs.docker.com/compose/>Docker Compose</a>.</p><p>After a lot of fiddling about, I finally managed it. As per the Docker IPv6
documentation, on Linux (I used Ubuntu Server) you need to add a configuration
file to enable IPv6, at <code>/etc/docker/daemon.json</code>:</p><pre><code>{
  &quot;ipv6&quot;: true,
  &quot;fixed-cidr-v6&quot;: &quot;2001:db8:1::/64&quot;
}
</code></pre><p>Then you need to restart Docker daemon:</p><p><code>$ sudo systemctl restart docker</code></p><p>that will allow the new <code>daemon.json</code> file to take effect.</p><p>After this, I had an existing setup with <a href=https://www.plex.tv/>Plex</a> and <a href=../self-host>other things</a> already
controlled by <code>docker-compose</code>. The solution here is to kill all your
containers and recreate the compose network by hand with IPv6 subnet:</p><pre><code>$ cd &lt;my_compose_dir&gt;
$ docker network ls # name of compose network should have directory name in it
$ docker network inspect &lt;compose_net_name&gt; # Make note of exisiting IPv4
Subnet/Gateway
$ docker-compose kill # Kill all your existing containers
$ docker network prune # Remove/Prune the network (as no more containers are attached)
$ docker network create --subnet=172.18.0.0/16 --gateway=172.18.0.1 --ipv6 --subnet=2001:db8:2::/64 &lt;compose_net_name&gt;
</code></pre><p>and lastly for the piece de resistance, let&rsquo;s bring up our compose containers:</p><p><code>$ docker-compose up -d</code></p><p>now we can also verify we get IPv6 working internally (see this <a href=http://collabnix.com/enabling-ipv6-functionality-for-docker-and-docker-compose/>helpful post
here</a>):</p><pre><code>$ docker run -itd ajeetraina/ubuntu-iproute bash # Start first container
$ docker run -itd ajeetraina/centos-iproute bash # Start second container (new
terminal)
</code></pre><p>In both containers you can run:</p><p><code>$ ifconfig eth0</code></p><p>which will show you the IPv6 address of each. Then from either container, you
can ping the other with:</p><p><code>$ ping6 &lt;ipv6_address></code></p><p>and it all should work nicely!</p></div></div><a href=https://twitter.com/share class=twitter-share-button data-size=small data-count=none>Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');</script><ul class=pager>&nbsp;<li class=previous><a href=../org-mode/>Learning Org Mode</a></li>&nbsp;<li class=next><a href=../kbc-tx-js/>Scraping Transaction Data from KBC Bank</a></li></ul></ul></div><footer><p class="text-muted credit">&copy; 2020. All rights reserved.</p></footer><script src=../js/jquery-1.10.2.min.js></script><script src=../js/bootstrap.min.js></script><script src=../js/bootstrap.js></script><script type=text/javascript src=../js/hc.js></script></body></html>