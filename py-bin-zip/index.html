<!DOCTYPE html>

<html lang="en-us">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>Python 3 In-Memory Zip File | Neil Grogan</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
    <link rel="manifest" href="../manifest.json">
    <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#FF3DB4">
    <link rel="me" href="https://mastodon.ie/@dueyfinster">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="../css/main.min.113b8750726301d2272b2fabf9695ed6bfe79dff4f4cd582cb3010010ebceea4.css"/>

    
    
    

    
    

    <script src="https://unpkg.com/lunr/lunr.js"></script>
 
    
  

</head>

    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="../">Neil Grogan</a>
    </div>  
</header>

  <div class="nav-menu">
  
    <a class="color-link nav-link" href="../about">About</a>
  
    <a class="color-link nav-link" href="../uses">Uses</a>
  
    <a class="color-link nav-link" href="../contact">Contact</a>
  
    <a class="color-link nav-link" href="../archives/">Archives</a>
  
    <a class="color-link nav-link" href="../tags/">Tags</a>
  
  <a class="color-link nav-link" href="../index.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
    
    

    

    

    

    

    

</div>




	<script src="../js/main.min.a7205ef73b078c8daed6fe1b0826e8ba229ffabbb69d299d9446cf41f2c7d8aa.js" integrity="sha256-pyBe9zsHjI2u1v4bCCbouiKf+ru2nSmdlEbPQfLH2Ko=" crossorigin="anonymous"></script><script src="../js/lunr-search.js" ></script>
</footer>
</nav>

        <div id="content" class="content-container">
        

<h1 class="post-title">Python 3 In-Memory Zip File</h1>
    
    <time>January 14, 2018</time>
    

    <div>
        
        <p>
        <p>
In Python, <a href="https://docs.python.org/3/library/io.html#io.BytesIO">BytesIO</a> is the way to store binary data in memory. Most examples you’ll see using zip files in memory is to store string data and indeed the most common example you’ll find online from the <a href="https://docs.python.org/3/library/zipfile.html">zipfile</a> module is <code>zipfile.writestr(file_name, &#34;Text Data&#34;)</code>. But what if you want to store binary data of a PDF or Excel Spreadsheet that’s also in memory?  You could use <code>zipfile.write()</code> (designed to take binary data) but then you can’t specify a filename (since our in-memory file was never written to a location on disk). The reason for this is simple: for a web request or for a test case, you shouldn’t need to store any files on disk.</p>
<p>
After a bit of experimentation, I finally was able to get  in-memory binary files written to an in-memory zip file:</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> io <span style="color:#f92672">import</span> BytesIO
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> zipfile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_zip</span>(files):
</span></span><span style="display:flex;"><span>    mem_zip <span style="color:#f92672">=</span> BytesIO()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> zipfile<span style="color:#f92672">.</span>ZipFile(mem_zip, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;w&#34;</span>,compression<span style="color:#f92672">=</span>zipfile<span style="color:#f92672">.</span>ZIP_DEFLATED) <span style="color:#66d9ef">as</span> zf:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> f <span style="color:#f92672">in</span> files:
</span></span><span style="display:flex;"><span>            zf<span style="color:#f92672">.</span>writestr(f[<span style="color:#ae81ff">0</span>], f[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> mem_zip<span style="color:#f92672">.</span>getvalue()
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_pdf</span>():
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">from</span> reportlab.pdfgen.canvas <span style="color:#f92672">import</span> Canvas
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">from</span> reportlab.lib.pagesizes <span style="color:#f92672">import</span> A4
</span></span><span style="display:flex;"><span>	buffer <span style="color:#f92672">=</span> BytesIO()
</span></span><span style="display:flex;"><span>    canvas <span style="color:#f92672">=</span> Canvas(buffer, pagesize<span style="color:#f92672">=</span>A4)
</span></span><span style="display:flex;"><span>    textobject <span style="color:#f92672">=</span> canvas<span style="color:#f92672">.</span>beginText(<span style="color:#ae81ff">1.5</span> <span style="color:#f92672">*</span> cm, <span style="color:#f92672">-</span><span style="color:#ae81ff">2.5</span> <span style="color:#f92672">*</span> cm)
</span></span><span style="display:flex;"><span>	textobject<span style="color:#f92672">.</span>textLine(<span style="color:#e6db74">&#34;Hello, world!&#34;</span>)
</span></span><span style="display:flex;"><span>	canvas<span style="color:#f92672">.</span>saveState()
</span></span><span style="display:flex;"><span>	canvas<span style="color:#f92672">.</span>save()
</span></span><span style="display:flex;"><span>    pdf <span style="color:#f92672">=</span> buffer<span style="color:#f92672">.</span>getvalue()
</span></span><span style="display:flex;"><span>    buffer<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> pdf
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>	file_names <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;test1.pdf&#34;</span>, <span style="color:#e6db74">&#34;test2.pdf&#34;</span>]
</span></span><span style="display:flex;"><span>	files <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> f <span style="color:#f92672">in</span> file_names:
</span></span><span style="display:flex;"><span>		pdf <span style="color:#f92672">=</span> generate_pdf() <span style="color:#75715e"># your file generation method goes here</span>
</span></span><span style="display:flex;"><span>		files<span style="color:#f92672">.</span>append((f, pdf))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	full_zip_in_memory <span style="color:#f92672">=</span> generate_zip(files)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>	main()</span></span></code></pre></div>
</div>

        </p>
    </div>
    

    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="../tags/programming">#programming</a>
        
            <a class="tag" href="../tags/code">#code</a>
        
            <a class="tag" href="../tags/python">#python</a>
        
      
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
    
    

    

    

    

    

    

</div>




	<script src="../js/main.min.a7205ef73b078c8daed6fe1b0826e8ba229ffabbb69d299d9446cf41f2c7d8aa.js" integrity="sha256-pyBe9zsHjI2u1v4bCCbouiKf+ru2nSmdlEbPQfLH2Ko=" crossorigin="anonymous"></script>
</footer>
    </body>
</html>