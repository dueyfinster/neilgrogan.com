<!doctype html><html lang=en><head><meta charset=utf-8><title>Scraping Transaction Data from KBC Bank</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.69.0"><link href rel=alternate type=application/rss+xml title="Neil Grogan"><link href=https://www.neilgrogan.com//css/bootstrap.min.css rel=stylesheet><link href=https://www.neilgrogan.com//css/hc.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css rel=stylesheet></head><body><div class=nav-toggle><i class="fa fa-bars fa-2x"></i>Herring Cove</div><div id=wrapper><div class="navbar navbar-default" role=navigation><div class=container><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a href=https://www.neilgrogan.com//><p class=navbar-brand>Neil Grogan</p></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav"></ul></div></div></div><div id=sidebar-wrapper><ul class=sidebar-nav><img src><li class=sidebar-brand><a href=https://www.neilgrogan.com//><h1 class=brand>Neil Grogan</h1></a><h3>My home on the internet</h3></li><hr><hr><div id=social-wrapper></div></ul></div><div class=container><div id=article><div class=article-title>Scraping Transaction Data from KBC Bank</div><p class=meta><small>&nbsp;<i class="fa fa-calendar-o"></i> 2019-05-13</small></p><hr><div class=post><p>In a previous post, I mentioned <a href=../bank-tx-py>importing transactions</a> using <a href=../ledger>ledger</a>/<a href=https://hledger.org/>hledger</a> and plain text accounting. As my former bank <a href=https://www.permanenttsb.ie/>PTSB</a> recently raised their fees, I decided to move to <a href=https://www.kbc.ie/>KBC</a>. I was excited to see, as part of the open payments directive, they have a nice <a href=https://www.kbc.ie/psd2-developer-portal/home>developer portal</a>. I reached out to KBC&rsquo;s dev team, but alas they are only accepting registered companies, who meet stringent criteria. They told me they hope to open it up soon to end users, I live in hope!</p><p>Another piece of bad news is that <a href=https://www.kbc.ie/>KBC</a> online banking has no way to download transactions! Also I couldn&rsquo;t re-use my <a href=../bank-tx-py>previous python script</a> as KBC make heavy use of two-factor authentication, meaning I&rsquo;d have to enter a code anyway. Plus I could rework the script, only to get access to the proper API and have to do it again. So I decided to log in to KBC manually, then use a Javascript bookmarklet to downloacd the transactions from the table.</p><p>Here&rsquo;s the bookmarklet:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>javascript</span><span style=color:#f92672>:</span>(<span style=color:#66d9ef>function</span>(){<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>downloadCSV</span>(<span style=color:#a6e22e>csv</span>,<span style=color:#a6e22e>filename</span>){<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>csvFile</span>;<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>downloadLink</span>;<span style=color:#a6e22e>csvFile</span><span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Blob</span>([<span style=color:#a6e22e>csv</span>],{<span style=color:#a6e22e>type</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;text/csv&#34;</span>});<span style=color:#a6e22e>downloadLink</span><span style=color:#f92672>=</span>document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#34;a&#34;</span>);<span style=color:#a6e22e>downloadLink</span>.<span style=color:#a6e22e>download</span><span style=color:#f92672>=</span><span style=color:#a6e22e>filename</span>;<span style=color:#a6e22e>downloadLink</span>.<span style=color:#a6e22e>href</span><span style=color:#f92672>=</span>window.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>createObjectURL</span>(<span style=color:#a6e22e>csvFile</span>);<span style=color:#a6e22e>downloadLink</span>.<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>display</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;none&#34;</span>;document.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>appendChild</span>(<span style=color:#a6e22e>downloadLink</span>);<span style=color:#a6e22e>downloadLink</span>.<span style=color:#a6e22e>click</span>()};<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>exportTableToCSV</span>(<span style=color:#a6e22e>filename</span>){<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>csv</span><span style=color:#f92672>=</span>[];<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rows</span><span style=color:#f92672>=</span>document.<span style=color:#a6e22e>querySelectorAll</span>(<span style=color:#e6db74>&#34;.table-transactions tr&#34;</span>);<span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;<span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>rows</span>.<span style=color:#a6e22e>length</span>;<span style=color:#a6e22e>i</span><span style=color:#f92672>+=</span><span style=color:#ae81ff>1</span>){<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>row</span><span style=color:#f92672>=</span>[],<span style=color:#a6e22e>cols</span><span style=color:#f92672>=</span><span style=color:#a6e22e>rows</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>querySelectorAll</span>(<span style=color:#e6db74>&#34;td, th&#34;</span>);<span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>j</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;<span style=color:#a6e22e>j</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>cols</span>.<span style=color:#a6e22e>length</span>;<span style=color:#a6e22e>j</span><span style=color:#f92672>+=</span><span style=color:#ae81ff>1</span>){<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>txt</span><span style=color:#f92672>=</span><span style=color:#a6e22e>cols</span>[<span style=color:#a6e22e>j</span>].<span style=color:#a6e22e>innerText</span>;<span style=color:#a6e22e>txt</span><span style=color:#f92672>=</span><span style=color:#a6e22e>txt</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;-&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>);<span style=color:#a6e22e>txt</span><span style=color:#f92672>=</span><span style=color:#a6e22e>txt</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;,&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>);<span style=color:#a6e22e>row</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>txt</span>)}<span style=color:#a6e22e>csv</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>row</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#34;,&#34;</span>))}<span style=color:#a6e22e>downloadCSV</span>(<span style=color:#a6e22e>csv</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#34;\n&#34;</span>),<span style=color:#a6e22e>filename</span>)}<span style=color:#a6e22e>exportTableToCSV</span>(<span style=color:#e6db74>&#34;kbc.csv&#34;</span>)})();
</code></pre></div><p>Simply add a new bookmark to your broswer, past the code above for the URL, then log in to KBC online banking and click your bookmark. It&rsquo;s still a bit rough around the edges (I didn&rsquo;t cater for the pagination, so it only dumps one page of transactions). But I can now get a CSV copy of the transactions, and I keep my ledger file happy (for now)!</p></div></div><a href=https://twitter.com/share class=twitter-share-button data-size=small data-count=none>Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');</script><ul class=pager>&nbsp;<li class=previous><a href=https://www.neilgrogan.com/docker-compose-ipv6/>Using IPv6 with Docker Compose on Ubuntu Server</a></li>&nbsp;<li class=next><a href=https://www.neilgrogan.com/ubnt/>Ubiquiti Home Network</a></li></ul></ul></div><footer><p class="text-muted credit">&copy; 2020. All rights reserved.</p></footer><script src=https://www.neilgrogan.com//js/jquery-1.10.2.min.js></script><script src=https://www.neilgrogan.com//js/bootstrap.min.js></script><script src=https://www.neilgrogan.com//js/bootstrap.js></script><script type=text/javascript src=https://www.neilgrogan.com//js/hc.js></script></body></html>