<!doctype html><html lang=en><head><meta charset=utf-8><title>Automated 'Push' Restaurant menu</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.69.0"><link href rel=alternate type=application/rss+xml title="Neil Grogan"><link href=../css/bootstrap.min.css rel=stylesheet><link href=../css/hc.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css rel=stylesheet></head><body><div class=nav-toggle><i class="fa fa-bars fa-2x"></i>Herring Cove</div><div id=wrapper><div class="navbar navbar-default" role=navigation><div class=container><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a href=../><p class=navbar-brand>Neil Grogan</p></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav"></ul></div></div></div><div id=sidebar-wrapper><ul class=sidebar-nav><img src><li class=sidebar-brand><a href=../><h1 class=brand>Neil Grogan</h1></a><h3>My home on the internet</h3></li><hr><hr><div id=social-wrapper></div></ul></div><div class=container><div id=article><div class=article-title>Automated 'Push' Restaurant menu</div><p class=meta><small>&nbsp;<i class="fa fa-calendar-o"></i> 2016-01-10</small></p><hr><div class=post><p>I love trying to automate the world, it just feels like magic some of the time! I also really enjoy information coming to me, instead of having to seek it. As we are still only in 2016, we have no world killing Artificial Intelligence (yet). So we have to start small, ease the first world problems! So I decided to make my workplaces&rsquo; restaurant menu come to me!</p><p>I decided to write it in Ruby and use push notifications, rather than email or SMS. It uses a web automation framework called <a href=http://www.seleniumhq.org/>Selenium</a>, which is available in many languages, including Javascript, Python, Java and obviously Ruby!</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#75715e>#!/usr/bin/env ruby</span>
<span style=color:#75715e>#Encoding: UTF-8</span>
require <span style=color:#e6db74>&#39;nokogiri&#39;</span>
require <span style=color:#e6db74>&#39;net/http&#39;</span>
require <span style=color:#e6db74>&#39;open-uri&#39;</span> 
require <span style=color:#e6db74>&#39;rushover&#39;</span>
<span style=color:#66d9ef>TOKEN</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e># Fill this in, get from Pushover</span>
<span style=color:#66d9ef>USER</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e># Fill this in, get from Pushover</span>

page_url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://www.ksgcatering.ie/restaurants/ericsson/athlone/menu/index.php&#34;</span>
today <span style=color:#f92672>=</span> <span style=color:#66d9ef>Time</span><span style=color:#f92672>.</span>now<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%A&#34;</span>)
items <span style=color:#f92672>=</span> <span style=color:#f92672>[]</span>
page <span style=color:#f92672>=</span> <span style=color:#66d9ef>Nokogiri</span><span style=color:#f92672>::</span><span style=color:#66d9ef>HTML</span>(open(page_url, <span style=color:#e6db74>:proxy</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>nil</span>))
page<span style=color:#f92672>.</span>xpath(<span style=color:#e6db74>&#34;//h2[contains(.,&#39;</span><span style=color:#e6db74>#{</span>today<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;)]/following-sibling::div[contains(@class, &#39;content&#39;)]/h4[contains(.,&#39;Main&#39;)]/following-sibling::p[position() &gt;= 0 and not(position() &gt; 3)]&#34;</span>)<span style=color:#f92672>.</span>each <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>node<span style=color:#f92672>|</span>
 items <span style=color:#f92672>&lt;&lt;</span> node<span style=color:#f92672>.</span>text
<span style=color:#66d9ef>end</span>
items<span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74> &#34;</span> <span style=color:#f92672>+</span> items<span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672>]</span>
items<span style=color:#f92672>.</span>map { <span style=color:#f92672>|</span>word<span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>=</span><span style=color:#e6db74>#{</span>word<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> }

client <span style=color:#f92672>=</span> <span style=color:#66d9ef>Rushover</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Client</span><span style=color:#f92672>.</span>new(<span style=color:#66d9ef>TOKEN</span>)
resp <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>notify(<span style=color:#66d9ef>USER</span>, items<span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#34;</span>), <span style=color:#e6db74>:sound</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;classical&#34;</span>, <span style=color:#e6db74>:device</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;iPhone&#34;</span>, <span style=color:#e6db74>:priority</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>:title</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;Today&#39;s Menu&#34;</span>)
resp<span style=color:#f92672>.</span>ok? <span style=color:#75715e># =&gt; true</span>

<span style=color:#75715e># Can check response from pushover if you want to verify it&#39;s sent</span>
<span style=color:#75715e>#puts resp.ok?</span>
</code></pre></div><p>I have it set to run as a cron job on my work laptop, with an added bonus that it doesn&rsquo;t run when I&rsquo;m on holiday as the laptop is off. Here&rsquo;s an example of the cron job:</p><pre><code class=language-cron data-lang=cron># m h  dom mon dow   command
45 10 * * 1,2,3,4,5 $HOME/canteen-menu.rb
</code></pre><p>As you can see in the comments, the format for cron (on Ubuntu Linux) is: Minute, Hour, Day of Month, Month, Day of Week, Command.</p><p>So the time it runs is 10:45, any day of month, any month, only run Mon-Fri (1,2,3,4,5) and run our script command, easy!</p></div></div><a href=https://twitter.com/share class=twitter-share-button data-size=small data-count=none>Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');</script><ul class=pager>&nbsp;<li class=previous><a href=../docker/>Adventures with Docker</a></li>&nbsp;<li class=next><a href=../autohours/>Fill hours worked in SAP Netweaver Automatically</a></li></ul></ul></div><footer><p class="text-muted credit">&copy; 2020. All rights reserved.</p></footer><script src=../js/jquery-1.10.2.min.js></script><script src=../js/bootstrap.min.js></script><script src=../js/bootstrap.js></script><script type=text/javascript src=../js/hc.js></script></body></html>