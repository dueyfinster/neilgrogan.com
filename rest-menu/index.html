<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no"><title>Automated 'Push' Restaurant menu | Neil Grogan</title><link rel=apple-touch-icon sizes=180x180 href=../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../favicon-16x16.png><link rel=icon type=image/png sizes=96x96 href=../favicon-96x96.png><link rel=manifest href=../manifest.json><link rel=mask-icon href=../safari-pinned-tab.svg color=#ff3db4><link rel=me href=https://mastodon.ie/@dueyfinster><meta name=theme-color content="#ffffff"><link rel=stylesheet href=../css/main.min.113b8750726301d2272b2fabf9695ed6bfe79dff4f4cd582cb3010010ebceea4.css><script src=https://unpkg.com/lunr/lunr.js></script></head><body><nav><header><div class=site-title><a href=../>Neil Grogan</a></div></header><div class=nav-menu><a class="color-link nav-link" href=../about>About</a>
<a class="color-link nav-link" href=../contact>Contact</a>
<a class="color-link nav-link" href=../archives/>Archives</a>
<a class="color-link nav-link" href=../tags/>Tags</a>
<a class="color-link nav-link" href=../index.xml target=_blank rel=noopener type=application/rss+xml>RSS</a></div><footer class=footer><div class=social-icons></div><script src=../js/main.min.a7205ef73b078c8daed6fe1b0826e8ba229ffabbb69d299d9446cf41f2c7d8aa.js integrity="sha256-pyBe9zsHjI2u1v4bCCbouiKf+ru2nSmdlEbPQfLH2Ko=" crossorigin=anonymous></script><script src=../js/lunr-search.js></script></footer></nav><div id=content class=content-container><h1 class=post-title>Automated 'Push' Restaurant menu</h1><time>January 10, 2016</time><div><p><p>I love trying to automate the world, it just feels like magic some of the time! I also really enjoy information coming to me, instead of having to seek it. As we are still only in 2016, we have no world killing Artificial Intelligence (yet). So we have to start small, ease the first world problems! So I decided to make my workplaces&rsquo; restaurant menu come to me!</p><p>I decided to write it in Ruby and use push notifications, rather than email or SMS. It uses a web automation framework called <a href=http://www.seleniumhq.org/>Selenium</a>, which is available in many languages, including Javascript, Python, Java and obviously Ruby!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env ruby</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Encoding: UTF-8</span>
</span></span><span style=display:flex><span>require <span style=color:#e6db74>&#39;nokogiri&#39;</span>
</span></span><span style=display:flex><span>require <span style=color:#e6db74>&#39;net/http&#39;</span>
</span></span><span style=display:flex><span>require <span style=color:#e6db74>&#39;open-uri&#39;</span> 
</span></span><span style=display:flex><span>require <span style=color:#e6db74>&#39;rushover&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>TOKEN</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e># Fill this in, get from Pushover</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>USER</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e># Fill this in, get from Pushover</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>page_url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://www.ksgcatering.ie/restaurants/ericsson/athlone/menu/index.php&#34;</span>
</span></span><span style=display:flex><span>today <span style=color:#f92672>=</span> <span style=color:#66d9ef>Time</span><span style=color:#f92672>.</span>now<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%A&#34;</span>)
</span></span><span style=display:flex><span>items <span style=color:#f92672>=</span> <span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>page <span style=color:#f92672>=</span> <span style=color:#66d9ef>Nokogiri</span><span style=color:#f92672>::</span><span style=color:#66d9ef>HTML</span>(open(page_url, <span style=color:#e6db74>:proxy</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>nil</span>))
</span></span><span style=display:flex><span>page<span style=color:#f92672>.</span>xpath(<span style=color:#e6db74>&#34;//h2[contains(.,&#39;</span><span style=color:#e6db74>#{</span>today<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;)]/following-sibling::div[contains(@class, &#39;content&#39;)]/h4[contains(.,&#39;Main&#39;)]/following-sibling::p[position() &gt;= 0 and not(position() &gt; 3)]&#34;</span>)<span style=color:#f92672>.</span>each <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>node<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span> items <span style=color:#f92672>&lt;&lt;</span> node<span style=color:#f92672>.</span>text
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>items<span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74> &#34;</span> <span style=color:#f92672>+</span> items<span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>items<span style=color:#f92672>.</span>map { <span style=color:#f92672>|</span>word<span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>=</span><span style=color:#e6db74>#{</span>word<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>client <span style=color:#f92672>=</span> <span style=color:#66d9ef>Rushover</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Client</span><span style=color:#f92672>.</span>new(<span style=color:#66d9ef>TOKEN</span>)
</span></span><span style=display:flex><span>resp <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>notify(<span style=color:#66d9ef>USER</span>, items<span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#34;</span>), <span style=color:#e6db74>:sound</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;classical&#34;</span>, <span style=color:#e6db74>:device</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;iPhone&#34;</span>, <span style=color:#e6db74>:priority</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>:title</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;Today&#39;s Menu&#34;</span>)
</span></span><span style=display:flex><span>resp<span style=color:#f92672>.</span>ok? <span style=color:#75715e># =&gt; true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Can check response from pushover if you want to verify it&#39;s sent</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#puts resp.ok?</span>
</span></span></code></pre></div><p>I have it set to run as a cron job on my work laptop, with an added bonus that it doesn&rsquo;t run when I&rsquo;m on holiday as the laptop is off. Here&rsquo;s an example of the cron job:</p><pre tabindex=0><code class=language-cron data-lang=cron># m h  dom mon dow   command
45 10 * * 1,2,3,4,5 $HOME/canteen-menu.rb
</code></pre><p>As you can see in the comments, the format for cron (on Ubuntu Linux) is: Minute, Hour, Day of Month, Month, Day of Week, Command.</p><p>So the time it runs is 10:45, any day of month, any month, only run Mon-Fri (1,2,3,4,5) and run our script command, easy!</p></p></div><div class=page-footer><hr class=footer-divider><a class=tag href=../tags/code>#code</a>
<a class=tag href=../tags/programming>#programming</a>
<a class=tag href=../tags/ruby>#ruby</a>
<a class=tag href=../tags/automation>#automation</a></div></div><footer class=footer-mobile><div class=social-icons></div><script src=../js/main.min.a7205ef73b078c8daed6fe1b0826e8ba229ffabbb69d299d9446cf41f2c7d8aa.js integrity="sha256-pyBe9zsHjI2u1v4bCCbouiKf+ru2nSmdlEbPQfLH2Ko=" crossorigin=anonymous></script></footer></body></html>