<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no"><title>Automatic Newsletter Cleanup in Gmail | Neil Grogan</title>
<link rel=apple-touch-icon sizes=180x180 href=../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../favicon-16x16.png><link rel=icon type=image/png sizes=96x96 href=../favicon-96x96.png><link rel=manifest href=../manifest.json><link rel=mask-icon href=../safari-pinned-tab.svg color=#FF3DB4><link rel=me href=https://mastodon.ie/@dueyfinster><meta name=theme-color content="#ffffff"><link rel=stylesheet href=../css/main.min.113b8750726301d2272b2fabf9695ed6bfe79dff4f4cd582cb3010010ebceea4.css><script src=https://unpkg.com/lunr/lunr.js></script></head><body><nav><header><div class=site-title><a href=../>Neil Grogan</a></div></header><div class=nav-menu><a class="color-link nav-link" href=../about>About</a>
<a class="color-link nav-link" href=../uses>Uses</a>
<a class="color-link nav-link" href=../contact>Contact</a>
<a class="color-link nav-link" href=../archives/>Archives</a>
<a class="color-link nav-link" href=../tags/>Tags</a>
<a class="color-link nav-link" href=../index.xml target=_blank rel=noopener type=application/rss+xml>RSS</a></div><footer class=footer><div class=social-icons></div><script src=../js/main.min.a7205ef73b078c8daed6fe1b0826e8ba229ffabbb69d299d9446cf41f2c7d8aa.js integrity="sha256-pyBe9zsHjI2u1v4bCCbouiKf+ru2nSmdlEbPQfLH2Ko=" crossorigin=anonymous></script><script src=../js/lunr-search.js></script></footer></nav><div id=content class=content-container><h1 class=post-title>Automatic Newsletter Cleanup in Gmail</h1><time>August 19, 2016</time><div><p><p>If you haven&rsquo;t tried <a href=https://developers.google.com/apps-script/>Google Apps Script</a>, I found a really nifty use for it: <em>smart filtering</em> for email. Wait, shouldn&rsquo;t I just use Gmails&rsquo; built-in filters? As it turns out you can&rsquo;t - my filter needs to act on email that matched that filter <em>in the past</em>. So in other words: a filter can only act on email it actually &ldquo;filters&rdquo;, which kinda makes sense! I&rsquo;m a big fan of automation (and email is ripe for automation), as you can see from <a href=../outlook>my post on meetings in Outlook</a>.</p><p>The source is below, all you need to do is replace the mailing list identifiers at
the start (see the comments). You can find these easily enough in Gmail by using
the dropdown menu on the email and selecting &ldquo;Filter mails like this&rdquo;:</p><p><img src=../img/16/gmail-menu-filter.png alt="Selecting a newsletter mail&rsquo;s menu to filter" title="Selecting a newsletter mail to filter"></p><p>This will prefill the search with the mailing list id you need:</p><p><img src=../img/16/gmail-filter-search.png alt="Gmail Filter Search" title="Gmail Filter Search in Action"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>processInbox</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Starting&#34;</span>);
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>mailingLists</span> <span style=color:#f92672>=</span> [ <span style=color:#75715e>// replace the strings in this array with your own!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#e6db74>&#34;list:&#39;faa8eb4ef3a111cef92c4f3d4mc list &lt;faa8eb4ef3a111cef92c4f3d4.583821.list-id.mcsv.net&gt;&#39;&#34;</span>, 
</span></span><span style=display:flex><span>     <span style=color:#e6db74>&#34;list:&#39;e2e180baf855ac797ef407fc7mc list &lt;e2e180baf855ac797ef407fc7.654029.list-id.mcsv.net&gt;&#39;&#34;</span>,
</span></span><span style=display:flex><span>     <span style=color:#e6db74>&#34;list:&#39;9f4b80a35728f7271fe3ea6ffmc list &lt;9f4b80a35728f7271fe3ea6ff.511493.list-id.mcsv.net&gt;&#39;&#34;</span>
</span></span><span style=display:flex><span>   ];
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>mailingLists</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>    <span style=color:#75715e>// process all threads in the Inbox
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>threads</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>searchMessages</span>(<span style=color:#a6e22e>mailingLists</span>[<span style=color:#a6e22e>i</span>]);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>threads</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>){
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Found: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>threads</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; messages to process, for &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>mailingLists</span>[<span style=color:#a6e22e>i</span>]);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>msgToSort</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getMessagesFromThreads</span>(<span style=color:#a6e22e>threads</span>);
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>msgToSort</span>.<span style=color:#a6e22e>sort</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>a</span>,<span style=color:#a6e22e>b</span>) { 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Date(<span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>date</span>).<span style=color:#a6e22e>getTime</span>() <span style=color:#f92672>-</span> <span style=color:#66d9ef>new</span> Date(<span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>date</span>).<span style=color:#a6e22e>getTime</span>();
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>msgToSort</span>.<span style=color:#a6e22e>splice</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>); <span style=color:#75715e>// Remove latest mail
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>msgToSort</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Moving message: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>msgToSort</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>subject</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; to trash&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>msgToSort</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>message</span>.<span style=color:#a6e22e>moveToTrash</span>();
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>msgToSort</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>searchMessages</span>(<span style=color:#a6e22e>filter</span>){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>GmailApp</span>.<span style=color:#a6e22e>search</span>(<span style=color:#a6e22e>filter</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getMessagesFromThreads</span>(<span style=color:#a6e22e>threads</span>){
</span></span><span style=display:flex><span> <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>msgsToSort</span><span style=color:#f92672>=</span>[];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>threads</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// get all messages in a given thread
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>messages</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>threads</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>getMessages</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>messages</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>msgsToSort</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>processMessage</span>(<span style=color:#a6e22e>messages</span>[<span style=color:#a6e22e>j</span>]));
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>msgsToSort</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>processMessage</span>(<span style=color:#a6e22e>message</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>subject</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>message</span>.<span style=color:#a6e22e>getSubject</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>date</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>message</span>.<span style=color:#a6e22e>getDate</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>date</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>subject</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {<span style=color:#e6db74>&#34;subject&#34;</span><span style=color:#f92672>:</span><span style=color:#a6e22e>subject</span>, <span style=color:#e6db74>&#34;message&#34;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>message</span>, <span style=color:#e6db74>&#34;date&#34;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>date</span> }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Also available as an easily cloneable (with git) <a href=https://gist.github.com/dueyfinster/a66238c3f99c883ffd8d264b539dc2d8>Gist on Github</a>.</p></p></div><div class=page-footer><hr class=footer-divider><a class=tag href=../tags/automation>#automation</a>
<a class=tag href=../tags/javascript>#javascript</a>
<a class=tag href=../tags/programming>#programming</a>
<a class=tag href=../tags/code>#code</a></div></div><footer class=footer-mobile><div class=social-icons></div><script src=../js/main.min.a7205ef73b078c8daed6fe1b0826e8ba229ffabbb69d299d9446cf41f2c7d8aa.js integrity="sha256-pyBe9zsHjI2u1v4bCCbouiKf+ru2nSmdlEbPQfLH2Ko=" crossorigin=anonymous></script></footer></body></html>