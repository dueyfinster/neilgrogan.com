<!DOCTYPE html>

<html lang="en-us">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>Kubernetes and Nix Cluster | Neil Grogan</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
    <link rel="manifest" href="../manifest.json">
    <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#FF3DB4">
    <link rel="me" href="https://mastodon.ie/@dueyfinster">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="../css/main.min.6dbb4e69ddaa86bff9659a7608e7652e05a3015456c03b9676176ff564510fe1.css"/>

    
    
    

    
    

    <script src="https://unpkg.com/lunr/lunr.js"></script>

    </head>

    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="../">Neil Grogan</a>
    </div>  
</header>

  <div class="nav-menu">
  
    <a class="color-link nav-link" href="../about">About</a>
  
    <a class="color-link nav-link" href="../uses">Uses</a>
  
    <a class="color-link nav-link" href="../contact">Contact</a>
  
    <a class="color-link nav-link" href="../archives/">Archives</a>
  
    <a class="color-link nav-link" href="../tags/">Tags</a>
  
  <a class="color-link nav-link" href="" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
    
    

    

    

    

    

    

</div>




	<script src="../js/main.min.a7205ef73b078c8daed6fe1b0826e8ba229ffabbb69d299d9446cf41f2c7d8aa.js" integrity="sha256-pyBe9zsHjI2u1v4bCCbouiKf+ru2nSmdlEbPQfLH2Ko=" crossorigin="anonymous"></script><script src="../js/lunr-search.js" ></script>
</footer>
</nav>

        <div id="content" class="content-container">
        

<h1 class="post-title">Kubernetes and Nix Cluster</h1>
    
    <time>August 29, 2025</time>
    

    <div>
        
        <p>
        <p>About this time last year, I purchased 3 mini computers with the aim of making a <a href="https://kubernetes.io/">Kubernetes</a> cluster. I followed an excellent youtube video: <a href="https://youtu.be/2yplBzPCghA?si=1Fq1Fx0PSvXP8krE">This homelab setup is my favorite one yet - Dreams of Autonomy</a> (<a href="https://github.com/dreamsofautonomy/homelab">Github Repository</a>) which described the machines to buy (Beelink EQ 13 Mini), how to upgrade the <abbr title="Solid State Disk">SSD</abbr> and <abbr title="Random Access Memory">RAM</abbr>, how to provision them with <a href="https://nixos.org">NixOS</a>, setup <a href="https://k3s.io">K3S</a>, and connect using <a href="https://kubectl.docs.kubernetes.io/guides/">kubectl</a> to manage the cluster. You will also have to modify your router&rsquo;s <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> settings so you can give the cluster static <abbr title="Internet Protocol">IP</abbr> addresses.</p>
<p>Things deployed on it (using <a href="https://helm.sh">Helm</a>/<a href="../DevOps/helmfile.md">helmfile</a> and <a href="../DevOps/kustomize.md">kustomize</a>):</p>
<ul>
<li><a href="https://longhorn.io">Longhorn</a> - for storage</li>
<li><a href="https://metallb.io">MetalLB</a> - for load-balancing and IP assignment</li>
<li><a href="https://nginx.org">Nginx</a> - as an ingress controller</li>
<li><a href="https://pi-hole.net">Pihole</a> - for ad blocking and DNS service</li>
<li><a href="https://github.com/kubernetes-sigs/external-dns">externaldns</a> - able to update Pihole DNS records when a new service is added</li>
</ul>
<p>These are all in the Github repo linked above. I&rsquo;ve since experimented with other services on the cluster such as:</p>
<ul>
<li>
<p><a href="https://grafana.com">Grafana</a> and <a href="https://prometheus.io">Prometheus</a> - for dashboards and monitoring</p>
</li>
<li>
<p><a href="https://fluxcd.io">Flux</a> - CI/CD deployment from config direct to the cluster</p>
</li>
<li>
<p><a href="https://livebook.dev">Livebook</a> - for live coding, and interacting with services</p>
</li>
<li>
<p><a href="https://redis.io">Redis</a> - as a data store (maybe I should have use <a href="https://valkey.io">Valkey</a>? )</p>
</li>
<li>
<p><a href="https://www.postgresql.org">Postgres</a> - database</p>
</li>
<li>
<p><a href="https://kafka.apache.org">Kafka</a> - message bus</p>
</li>
<li>
<p>and more I&rsquo;m currently trying..</p>
</li>
</ul>
<h3 id="things-that-have-surprised-me-are">Things that have surprised me are:</h3>
<ul>
<li>There was a small configuration value missing from the video, which <a href="https://github.com/dreamsofautonomy/homelab/pull/1">I created a pull request to address</a></li>
<li>the lack of readily available and easily usable Helm charts on <a href="https://artifacthub.io">ArtifactHub</a> - Bitnami filled this role somewhat but <a href="https://github.com/bitnami/charts/issues/35164">has converted to a commerical model</a>, disappointingly</li>
<li>I tried to use <abbr title="Large Language Models">LLMs</abbr> to give me correct helm values but it always got confused (should it not be simple?)</li>
<li>the sheer amount of YAML config</li>
<li>Troubleshooting needs a defined workflow of what to check (but this is useful to practice)</li>
<li>Nix running out of space on <code>/boot</code> while trying to upgrade the Linux kernel</li>
</ul>
<h3 id="things-that-worked-well">Things that worked well</h3>
<ul>
<li>The hardware was very easy to use and upgrade</li>
<li>Nix has been solid in upgrades (I expected things to break - only one was the <code>/boot</code> issue above)</li>
<li>Using internal or external domains was easier than I thought, I&rsquo;ve exposed some on <code>.lan</code> and some on a public domain</li>
<li>kubectl is a nice tool, the information density is good</li>
<li>Helmfile is a nice way to deploy</li>
<li>Livebooks were brilliant to test other services, e.g. I wrote Elixir to interact with Postgres, Redis and other services on the cluster</li>
</ul>
<h3 id="would-i-do-this-again">Would I do this again?</h3>
<p>I&rsquo;m happy I did this as it&rsquo;s been a great learning opportunity for me to break things and fix them again. Kubernetes can be a bit off-putting with concepts, how they are linked and how to just deploy something quickly to verify it works. There&rsquo;s a lot to understand before something works.</p>
<p>I really would only recommend using Kubernetes an Enterprise context where you have more than one workload. For simpler apps, I would stick to docker, docker-compose and things like Dokku. Or of course doing it just for fun, learning and experimenting!</p>

        </p>
    </div>
    

    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="../tags/hardware">#hardware</a>
        
            <a class="tag" href="../tags/review">#review</a>
        
      
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
    
    

    

    

    

    

    

</div>




	<script src="../js/main.min.a7205ef73b078c8daed6fe1b0826e8ba229ffabbb69d299d9446cf41f2c7d8aa.js" integrity="sha256-pyBe9zsHjI2u1v4bCCbouiKf+ru2nSmdlEbPQfLH2Ko=" crossorigin="anonymous"></script>
</footer>
    </body>
</html>